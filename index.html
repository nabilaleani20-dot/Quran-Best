<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al-Qur'an Digital - Tajwid Label & Kuis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@300;400;600;700&display=swap');
        
        .arabic { font-family: 'Amiri', serif; }
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* --- SISTEM WARNA & LABEL TAJWID DENGAN SUB-LABEL --- */
        .tj-wrapper { display: inline-flex; flex-direction: column; align-items: center; vertical-align: middle; margin: 0 2px; }
        .tj-label { font-size: 10px; font-family: 'Inter', sans-serif; font-weight: bold; line-height: 1; margin-top: -5px; opacity: 0.8; }

        .tj-ghunnah { color: #dc2626; font-weight: bold; }
        .tj-ikhfa-hakiki { color: #2563eb; font-weight: bold; }
        .tj-idgham-bigunnah { color: #9333ea; font-weight: bold; }
        .tj-idgham-bilagunnah { color: #6b21a8; font-weight: bold; }
        .tj-iqlab { color: #0891b2; font-weight: bold; }
        .tj-qalqalah { color: #d97706; font-weight: bold; border-bottom: 2px solid #d97706; }
        .tj-mad-thobii { color: #16a34a; }
        .tj-mad-wajib { color: #059669; font-weight: bold; text-decoration: underline; }
        .tj-mad-jaiz { color: #047857; font-weight: bold; border-bottom: 1px dashed #047857; }
        .tj-alsyamsiyah { color: #64748b; font-style: italic; }
        .tj-alqamariyah { color: #334155; font-weight: bold; }
        .tj-mimsyafawi { color: #be185d; border-bottom: 1px dashed #be185d; }
        .tj-izhar-halqi { color: #475569; border-left: 3px solid #475569; padding-right: 2px; }

        @keyframes pulse-emerald {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        .adzan-playing { animation: pulse-emerald 2s infinite; }

        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #059669; }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body class="pb-24">

    <!-- Header -->
    <header class="bg-emerald-700 text-white p-6 sticky top-0 z-50 shadow-md">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold flex items-center gap-2">
                <i class="fas fa-kaaba"></i> Qur'an & Adzan
            </h1>
            <div id="clock" class="text-right text-lg font-mono bg-emerald-800 px-3 py-1 rounded shadow-inner">00:00:00</div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 min-h-screen">
        
        <!-- Tab: Al-Quran -->
        <section id="quran-tab" class="tab-content active">
            <div class="mb-6">
                <input type="text" id="searchSurah" placeholder="Cari nama surah..." class="w-full p-4 rounded-2xl border border-gray-200 shadow-sm focus:ring-2 focus:ring-emerald-500 outline-none transition">
            </div>
            <div id="surahList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            
            <div id="surahDetail" class="hidden fixed inset-0 bg-white z-[60] overflow-y-auto p-4">
                <div class="max-w-3xl mx-auto">
                    <button onclick="closeSurah()" class="mb-4 text-emerald-700 font-semibold flex items-center gap-2 p-2 hover:bg-emerald-50 rounded-lg transition">
                        <i class="fas fa-arrow-left"></i> Kembali
                    </button>
                    <div id="surahContent"></div>
                </div>
            </div>
        </section>

        <!-- Tab: Adzan -->
        <section id="prayer-tab" class="tab-content">
            <div class="glass-morphism rounded-3xl p-6 shadow-xl mb-6 border-t-4 border-emerald-600">
                <div class="mb-6">
                    <label class="block text-sm font-bold text-gray-700 mb-2 text-center">Lokasi Shalat:</label>
                    <input type="text" id="citySearchInput" oninput="searchCity(this.value)" placeholder="Cari nama kota..." class="w-full p-4 rounded-2xl border border-gray-200 focus:ring-2 focus:ring-emerald-500 outline-none">
                    <div id="citySearchResults" class="absolute left-0 right-0 mt-2 bg-white border border-gray-100 rounded-xl shadow-2xl z-20 max-h-60 overflow-y-auto hidden"></div>
                </div>
                <div id="prayerInfoArea" class="text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-1" id="locationLabel">Memuat Lokasi...</h2>
                    <p id="currentDate" class="text-gray-500 mb-6 italic">---</p>
                    <div id="prayerTimes" class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8"></div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-lg space-y-6">
                <div class="flex items-center justify-between p-4 bg-emerald-50 rounded-2xl border border-emerald-100">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-emerald-100 text-emerald-600 rounded-xl flex items-center justify-center"><i class="fas fa-robot"></i></div>
                        <div>
                            <h4 class="font-bold text-gray-800 text-sm">Adzan Otomatis</h4>
                            <p class="text-[10px] text-gray-500" id="autoAdzanStatusText">Status: Non-aktif</p>
                        </div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="autoAdzanToggle" onchange="toggleAutoAdzanSystem()">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div id="adzanIconContainer" class="w-12 h-12 bg-gray-100 text-gray-400 rounded-2xl flex items-center justify-center text-xl transition-all">
                            <i class="fas fa-volume-mute" id="adzanStatusIcon"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800">Suara Adzan</h3>
                            <p class="text-[10px] text-gray-500" id="adzanSubtext">Tekan tes untuk mencoba.</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <button id="btnPlayAdzan" onclick="toggleTestAdzan()" class="flex-1 bg-emerald-600 text-white py-4 rounded-2xl font-bold hover:bg-emerald-700 transition flex items-center justify-center gap-3 shadow-lg">
                        <i class="fas fa-play" id="testAdzanIcon"></i>
                        <span id="testAdzanText">Tes Suara</span>
                    </button>
                    <button id="btnStopAdzan" onclick="stopAdzan()" class="hidden bg-rose-100 text-rose-600 px-6 rounded-2xl font-bold hover:bg-rose-200 transition">
                        <i class="fas fa-stop"></i> Stop
                    </button>
                </div>
            </div>
        </section>

        <!-- Tab: Kuis -->
        <section id="quiz-tab" class="tab-content">
            <div id="quiz-container" class="glass-morphism rounded-[2.5rem] p-8 shadow-2xl max-w-xl mx-auto text-center border border-white">
                <div id="quiz-start">
                    <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-lightbulb text-3xl text-emerald-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold mb-2">Kuis Al-Qur'an</h2>
                    <p class="text-gray-500 text-sm mb-6">Uji wawasan Tajwid, Arti Surah, dan Isi Kandungan Al-Qur'an.</p>
                    <button onclick="startQuiz()" class="bg-emerald-600 text-white px-10 py-4 rounded-2xl font-bold hover:bg-emerald-700 w-full shadow-lg transition">Mulai Sekarang</button>
                </div>
                <div id="quiz-active" class="hidden text-left">
                    <div class="flex justify-between items-center mb-4">
                        <span id="quiz-category" class="text-[10px] font-bold bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full uppercase tracking-wider">Kategori</span>
                        <span id="quiz-progress" class="text-[10px] font-bold text-gray-400">1 / 5</span>
                    </div>
                    <h3 id="quiz-question" class="text-xl font-bold mb-6 text-gray-800 leading-tight"></h3>
                    <div id="quiz-options" class="space-y-3"></div>
                    <div id="quiz-feedback" class="mt-8 p-4 rounded-2xl hidden transition-all duration-300">
                        <p id="feedback-text" class="font-bold text-center text-sm mb-4"></p>
                        <button onclick="nextQuestion()" class="bg-emerald-600 text-white px-8 py-3 rounded-xl font-bold w-full shadow-md">Lanjut</button>
                    </div>
                </div>
                <div id="quiz-result" class="hidden">
                    <h2 class="text-xl font-bold mb-2">Skor Akhir Anda</h2>
                    <div id="final-score" class="text-8xl font-black mb-6 text-emerald-600">0</div>
                    <p id="result-message" class="text-gray-500 mb-8 italic">Teruslah belajar dan membaca!</p>
                    <button onclick="resetQuiz()" class="bg-emerald-600 text-white px-8 py-4 rounded-2xl font-bold w-full shadow-xl">Ulangi Kuis</button>
                </div>
            </div>
        </section>

    </main>

    <!-- Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-gray-100 flex justify-around p-3 z-50 shadow-2xl">
        <button onclick="switchTab('quran')" class="nav-btn active flex flex-col items-center p-2 text-emerald-600" id="nav-quran">
            <i class="fas fa-book-quran text-xl"></i>
            <span class="text-[10px] mt-1 font-bold uppercase">Quran</span>
        </button>
        <button onclick="switchTab('prayer')" class="nav-btn flex flex-col items-center p-2 text-gray-400" id="nav-prayer">
            <i class="fas fa-clock text-xl"></i>
            <span class="text-[10px] mt-1 font-bold uppercase">Adzan</span>
        </button>
        <button onclick="switchTab('quiz')" class="nav-btn flex flex-col items-center p-2 text-gray-400" id="nav-quiz">
            <i class="fas fa-graduation-cap text-xl"></i>
            <span class="text-[10px] mt-1 font-bold uppercase">Kuis</span>
        </button>
    </nav>

    <audio id="murottalPlayer"></audio>
    <audio id="adzanPlayer" src="https://www.islamcan.com/audio/adhan/azan1.mp3" preload="auto"></audio>

    <script>
        let allSurahs = [];
        let isMurottalPlaying = false;
        let isAdzanTesting = false;
        let isAutoAdzanEnabled = false; 
        let prayerSchedule = {}; 
        let lastPlayedMinute = ""; 

        window.onload = () => {
            fetchSurahs();
            getPrayerTimes("1301", "Jakarta"); 
            setInterval(runBackgroundCheck, 1000);
            const adzanPlayer = document.getElementById('adzanPlayer');
            adzanPlayer.onended = () => stopAdzan();
        };

        // --- SISTEM DETEKSI TAJWID DENGAN LABEL VISUAL ---
        function applySpecificTajwid(text) {
            function wrap(txt, className, label) {
                return `<span class="tj-wrapper"><span class="${className}">${txt}</span><span class="tj-label ${className}">${label}</span></span>`;
            }

            // Al-Syamsiyah
            text = text.replace(/(ال\s*[تثدذرزسشصضطظلن]ّ)/g, (m) => wrap(m, 'tj-alsyamsiyah', 'Syamsiyah'));
            // Al-Qamariyah
            text = text.replace(/(ال\s*[ابجحخعغفقكموهي])/g, (m) => wrap(m, 'tj-alqamariyah', 'Qamariyah'));
            // Ghunnah
            text = text.replace(/([نّمّ]ّ)/g, (m) => wrap(m, 'tj-ghunnah', 'Ghunnah'));
            // Mim Mati
            text = text.replace(/(مْ\s*[بم]ّ?)/g, (m) => wrap(m, 'tj-mimsyafawi', 'MimMati'));
            // Iqlab
            text = text.replace(/([ًٌٍن]ْ?\s*[ب])/g, (m) => wrap(m, 'tj-iqlab', 'Iqlab'));
            // Idgham Bigunnah
            text = text.replace(/([ًٌٍن]ْ?\s*[ينمو]ّ?)/g, (m) => wrap(m, 'tj-idgham-bigunnah', 'IdghamBig.'));
            // Idgham Bilagunnah
            text = text.replace(/([ًٌٍن]ْ?\s*[لر]ّ?)/g, (m) => wrap(m, 'tj-idgham-bilagunnah', 'IdghamBil.'));
            // Ikhfa Hakiki
            text = text.replace(/([ًٌٍن]ْ?\s*[تثجحدذرزسشصضطظفقك])/g, (m) => wrap(m, 'tj-ikhfa-hakiki', 'Ikhfa'));
            // Izhar Halqi
            text = text.replace(/([ًٌٍن]ْ?\s*[ءهحخعغ])/g, (m) => wrap(m, 'tj-izhar-halqi', 'Izhar'));
            // Qalqalah
            text = text.replace(/([بجطدقت]ْ)/g, (m) => wrap(m, 'tj-qalqalah', 'Qalqalah'));
            // Mad Wajib
            text = text.replace(/([َُِ][اوي]ْ?\s*[ء])/g, (m) => wrap(m, 'tj-mad-wajib', 'MadWajib'));
            // Mad Jaiz
            text = text.replace(/([َُِ][اوي]ْ?\s*[أإ])/g, (m) => wrap(m, 'tj-mad-jaiz', 'MadJaiz'));
            // Mad Thobi'i (Handle carefully so not to double wrap)
            text = text.replace(/([َ]ا|[ُ]و|[ِ]ي)/g, (m) => {
                if (m.includes('tj-')) return m;
                return wrap(m, 'tj-mad-thobii', 'MadThobii');
            });
            
            return text;
        }

        async function fetchSurahs() {
            try {
                const res = await fetch('https://equran.id/api/v2/surat');
                const data = await res.json();
                allSurahs = data.data;
                renderSurahs(allSurahs);
            } catch (e) {}
        }

        function renderSurahs(list) {
            const container = document.getElementById('surahList');
            container.innerHTML = list.map(s => `
                <div onclick="viewSurah(${s.nomor})" class="bg-white p-5 rounded-2xl border border-gray-100 hover:border-emerald-500 cursor-pointer transition shadow-sm flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-emerald-50 text-emerald-700 rounded-lg flex items-center justify-center font-bold text-xs">${s.nomor}</div>
                        <div><h3 class="font-bold text-gray-800 text-sm">${s.namaLatin}</h3><p class="text-[10px] text-gray-400 uppercase">${s.arti}</p></div>
                    </div>
                    <div class="arabic text-xl text-emerald-700">${s.nama}</div>
                </div>
            `).join('');
        }

        async function viewSurah(id) {
            const content = document.getElementById('surahContent');
            document.getElementById('surahDetail').classList.remove('hidden');
            content.innerHTML = '<div class="p-20 text-center"><i class="fas fa-spinner fa-spin text-3xl text-emerald-600"></i></div>';
            
            try {
                const res = await fetch(`https://equran.id/api/v2/surat/${id}`);
                const data = await res.json();
                const surah = data.data;

                content.innerHTML = `
                    <div class="text-center mb-8 bg-emerald-900 p-8 rounded-[2.5rem] text-white shadow-xl">
                        <h1 class="arabic text-6xl mb-4">${surah.nama}</h1>
                        <h2 class="text-2xl font-bold mb-2">${surah.namaLatin}</h2>
                        <button onclick="toggleMurottal('${surah.audioFull['05']}')" class="bg-white text-emerald-900 px-6 py-2 rounded-xl font-bold text-sm flex items-center gap-2 mx-auto mt-4">
                            <i class="fas ${isMurottalPlaying ? 'fa-pause' : 'fa-play'}" id="murottalIcon"></i> Putar Audio
                        </button>
                    </div>
                    <div class="bg-emerald-50 p-6 rounded-3xl border border-emerald-100 mb-8">
                        <h3 class="font-bold text-emerald-800 mb-2">Ringkasan Surah:</h3>
                        <p class="text-xs text-gray-600 leading-relaxed">${surah.deskripsi}</p>
                    </div>
                    <div class="space-y-12 pb-20">
                        ${surah.ayat.map(a => `
                        <div class="border-b border-gray-100 pb-12">
                            <div class="flex flex-row-reverse gap-4 mb-6">
                                <div class="arabic text-5xl text-right leading-[3.2] text-gray-800 flex-1" dir="rtl">
                                    ${applySpecificTajwid(a.teksArab)}
                                    <span class="inline-flex w-10 h-10 bg-emerald-100 text-emerald-800 rounded-full items-center justify-center text-xs font-bold mr-4" style="vertical-align: super;">${a.nomorAyat}</span>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm leading-relaxed">${a.teksIndonesia}</p>
                        </div>`).join('')}
                    </div>
                `;
            } catch (e) {}
        }

        // --- KUIS LOGIC ---
        let curQIdx = 0, score = 0, currentQuestions = [];
        
        const questionPool = [
            {cat: "Tajwid", q: "Hukum Nun mati/Tanwin bertemu huruf 'Ba' disebut?", a: ["Ikhfa", "Iqlab", "Izhar", "Idgham"], c: 1},
            {cat: "Tajwid", q: "Mad yang dibaca sepanjang 2 harakat secara alami disebut?", a: ["Mad Jaiz", "Mad Wajib", "Mad Thobi'i", "Mad Arid"], c: 2},
            {cat: "Tajwid", q: "Manakah yang termasuk huruf Qalqalah?", a: ["Huruf Alif", "Huruf Ba", "Huruf Ra", "Huruf Sin"], c: 1},
            {cat: "Arti Surah", q: "Apa arti dari nama Surah Al-Fatihah?", a: ["Sapi Betina", "Pembukaan", "Masa/Waktu", "Bintang"], c: 1},
            {cat: "Arti Surah", q: "Surah An-Nas memiliki arti?", a: ["Manusia", "Semut", "Lebah", "Gajah"], c: 0},
            {cat: "Arti Surah", q: "Apa arti dari nama Surah Al-Fil?", a: ["Kuda", "Gajah", "Burung", "Onta"], c: 1},
            {cat: "Isi Surah", q: "Berapa jumlah ayat dalam Surah Al-Ikhlas?", a: ["3 Ayat", "4 Ayat", "5 Ayat", "6 Ayat"], c: 1},
            {cat: "Isi Surah", q: "Surah yang menceritakan tentang kenikmatan yang banyak adalah?", a: ["Al-Kafirun", "Al-Ashr", "Al-Kautsar", "Ad-Duha"], c: 2},
            {cat: "Isi Surah", q: "Surah Al-Alaq ayat 1-5 turun di mana?", a: ["Gua Hira", "Gua Tsur", "Masjid Nabawi", "Padang Arafah"], c: 0},
            {cat: "Isi Surah", q: "Manakah surah yang disebut sebagai Ummul Qur'an?", a: ["Al-Ikhlas", "Al-Baqarah", "Al-Fatihah", "Yasin"], c: 2}
        ];

        function startQuiz() { 
            curQIdx = 0; score = 0; 
            currentQuestions = [...questionPool].sort(() => Math.random() - 0.5).slice(0, 5);
            document.getElementById('quiz-start').classList.add('hidden'); 
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('quiz-active').classList.remove('hidden'); 
            showQuestion(); 
        }

        function showQuestion() { 
            const q = currentQuestions[curQIdx]; 
            document.getElementById('quiz-category').innerText = q.cat;
            document.getElementById('quiz-progress').innerText = `${curQIdx + 1} / ${currentQuestions.length}`;
            document.getElementById('quiz-question').innerText = q.q; 
            document.getElementById('quiz-feedback').classList.add('hidden'); 
            document.getElementById('quiz-options').innerHTML = q.a.map((opt, i) => `
                <button onclick="checkAnswer(${i})" class="quiz-opt-btn w-full text-left p-4 rounded-xl border-2 border-gray-100 font-bold bg-white hover:border-emerald-200 transition-all text-sm">
                    ${opt}
                </button>
            `).join(''); 
        }

        function checkAnswer(i) { 
            const correctIdx = currentQuestions[curQIdx].c;
            const buttons = document.querySelectorAll('.quiz-opt-btn');
            buttons.forEach((btn, idx) => {
                btn.disabled = true;
                if(idx === correctIdx) btn.classList.add('border-emerald-500', 'bg-emerald-50', 'text-emerald-700');
                else if(idx === i) btn.classList.add('border-rose-500', 'bg-rose-50', 'text-rose-700');
            });
            const feedback = document.getElementById('quiz-feedback');
            const feedbackText = document.getElementById('feedback-text');
            if(i === correctIdx) {
                score += 20;
                feedbackText.innerText = "Maa Syaa Allah! Jawaban Benar.";
                feedback.className = "mt-8 p-4 rounded-2xl block bg-emerald-100 text-emerald-800";
            } else {
                feedbackText.innerText = `Kurang tepat. Jawaban yang benar: ${currentQuestions[curQIdx].a[correctIdx]}`;
                feedback.className = "mt-8 p-4 rounded-2xl block bg-rose-100 text-rose-800";
            }
        }

        function nextQuestion() { 
            curQIdx++; 
            if(curQIdx < currentQuestions.length) showQuestion(); 
            else { 
                document.getElementById('quiz-active').classList.add('hidden'); 
                document.getElementById('quiz-result').classList.remove('hidden'); 
                document.getElementById('final-score').innerText = score; 
                document.getElementById('result-message').innerText = score >= 80 ? "Luar biasa! Wawasan Anda sangat baik." : "Ayo terus belajar Al-Qur'an!";
            } 
        }

        function resetQuiz() { 
            document.getElementById('quiz-result').classList.add('hidden'); 
            document.getElementById('quiz-start').classList.remove('hidden'); 
        }

        // --- SISTEM ADZAN ---
        function runBackgroundCheck() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('id-ID', {hour12: false, hour: '2-digit', minute: '2-digit'});
            document.getElementById('clock').innerText = now.toLocaleTimeString('id-ID', {hour12: false});
            if (isAutoAdzanEnabled && lastPlayedMinute !== timeStr) {
                const keys = ['subuh', 'dzuhur', 'ashar', 'maghrib', 'isya'];
                for (let key of keys) {
                    if (prayerSchedule[key] === timeStr) {
                        lastPlayedMinute = timeStr;
                        triggerAutoPlay(key, timeStr);
                        break;
                    }
                }
            }
        }

        function triggerAutoPlay(name, time) {
            document.getElementById('adzanPlayer').play();
            isAdzanTesting = true;
            document.getElementById('adzanStatusIcon').className = "fas fa-bell text-emerald-600";
            document.getElementById('adzanSubtext').innerText = `Waktu ${name.toUpperCase()} tiba.`;
            document.getElementById('btnStopAdzan').classList.remove('hidden');
            document.getElementById('adzanIconContainer').classList.add('adzan-playing', 'bg-emerald-600', 'text-white');
        }

        function toggleAutoAdzanSystem() {
            isAutoAdzanEnabled = document.getElementById('autoAdzanToggle').checked;
            document.getElementById('autoAdzanStatusText').innerText = isAutoAdzanEnabled ? "Status: Aktif" : "Status: Non-aktif";
            if(!isAutoAdzanEnabled) stopAdzan();
        }

        function toggleTestAdzan() {
            const p = document.getElementById('adzanPlayer');
            if (!isAdzanTesting) { p.play(); isAdzanTesting = true; document.getElementById('testAdzanIcon').className = "fas fa-pause"; document.getElementById('btnStopAdzan').classList.remove('hidden'); }
            else { p.pause(); isAdzanTesting = false; document.getElementById('testAdzanIcon').className = "fas fa-play"; }
        }

        function stopAdzan() {
            const p = document.getElementById('adzanPlayer');
            p.pause(); p.currentTime = 0; isAdzanTesting = false;
            document.getElementById('btnStopAdzan').classList.add('hidden');
            document.getElementById('adzanIconContainer').classList.remove('adzan-playing', 'bg-emerald-600', 'text-white');
            document.getElementById('adzanStatusIcon').className = "fas fa-volume-mute";
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(id+'-tab').classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.replace('text-emerald-600', 'text-gray-400'));
            document.getElementById('nav-'+id).classList.replace('text-gray-400', 'text-emerald-600');
        }

        async function getPrayerTimes(id, name) {
            const d = new Date();
            const res = await fetch(`https://api.myquran.com/v2/sholat/jadwal/${id}/${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`);
            const data = await res.json();
            const j = data.data.jadwal;
            prayerSchedule = { subuh: j.subuh, dzuhur: j.dzuhur, ashar: j.ashar, maghrib: j.maghrib, isya: j.isya };
            document.getElementById('locationLabel').innerText = name;
            document.getElementById('currentDate').innerText = j.tanggal;
            const tms = [{n:'Subuh',v:j.subuh},{n:'Dzuhur',v:j.dzuhur},{n:'Ashar',v:j.ashar},{n:'Maghrib',v:j.maghrib},{n:'Isya',v:j.isya}];
            document.getElementById('prayerTimes').innerHTML = tms.map(t => `<div class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm"><div class="text-[10px] text-gray-400 font-bold uppercase mb-1">${t.n}</div><div class="text-2xl font-black text-emerald-800">${t.v}</div></div>`).join('');
        }

        async function searchCity(q) {
            if(q.length < 3) return;
            const res = await fetch(`https://api.myquran.com/v2/sholat/kota/cari/${q}`);
            const data = await res.json();
            if(data.status) {
                document.getElementById('citySearchResults').innerHTML = data.data.map(c => `<div onclick="selectCity('${c.id}','${c.lokasi}')" class="p-4 hover:bg-emerald-50 cursor-pointer border-b border-gray-50 text-xs">${c.lokasi}</div>`).join('');
                document.getElementById('citySearchResults').classList.remove('hidden');
            }
        }

        function selectCity(id, name) {
            document.getElementById('citySearchInput').value = name;
            document.getElementById('citySearchResults').classList.add('hidden');
            getPrayerTimes(id, name);
        }

        function toggleMurottal(url) {
            const p = document.getElementById('murottalPlayer');
            const icon = document.getElementById('murottalIcon');
            if(!isMurottalPlaying) { p.src = url; p.play(); isMurottalPlaying = true; icon.className = "fas fa-pause"; }
            else { p.pause(); isMurottalPlaying = false; icon.className = "fas fa-play"; }
        }

        function closeSurah() {
            document.getElementById('surahDetail').classList.add('hidden');
            document.getElementById('murottalPlayer').pause();
            isMurottalPlaying = false;
        }

        document.getElementById('searchSurah').addEventListener('input', (e) => {
            const v = e.target.value.toLowerCase();
            renderSurahs(allSurahs.filter(s => s.namaLatin.toLowerCase().includes(v)));
        });
    </script>
</body>
</html>